import{l as I,r as y,D as x,j as e,n as R,p as k,i as w,B as m,F as z,T as C}from"./index-a41f8ece.js";import{i as B,C as j,T as _,a as N,b as $,c as b,d as A,e as O,f as D,g as W,L as U,G as Y,I as V,h as F,j as G,k as P,M as H}from"./index-4186fb26.js";import{M as K,a as q,C as J,b as Q,c as X}from"./chunk-KHDB22PD-6e4f8189.js";import"./index-3977fc83.js";import"./index-37ac690d.js";var Z=I({d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z",displayName:"ChevronLeftIcon"}),ee=I({d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",displayName:"ChevronRightIcon"});const T=(s,a,n)=>{const l=n?{"R-views":"#F8B4B5","R-downloads":"#FBC6CF","R-outlinks":"#FDD9E6","R-conversions":"#fff0aa","N-views":"#059FCC","N-downloads":"#05AFE0","N-outlinks":"#05C0F6","N-conversions":"#fff0aa","L-views":"#9E4F9D","L-downloads":"#A78FB4","L-outlinks":"#C4C8E2","L-conversions":"#fff0aa","ALL-views":"#CCCCCC","ALL-downloads":"#D6D6D6","ALL-outlinks":"#E0E0E0","ALL-conversions":"#fff0aa","L-L":"#8B92B3","R-R":"#D9BAB9","N-N":"#06B9ED"}:{"R-views":"#F1686A","R-downloads":"#F57B90","R-outlinks":"#F88DB6","R-conversions":"#fff0aa","N-views":"#059FCC","N-downloads":"#05AFE0","N-outlinks":"#05C0F6","N-conversions":"#fff0aa","L-views":"#7C3E7B","L-downloads":"#8F70A0","L-outlinks":"#ADB3D7","L-conversions":"#fff0aa","L-ALL":"#8B92B3","R-ALL":"#D9BAB9","N-ALL":"#13D7FC"},c=`${s}-${a}`;return l[c]||"#B8B8B8"},E=(s,a)=>{const n=[];return typeof a=="string"?(s.time.buckets.map(r=>{var i,d,u;const t=r.level.buckets.find(h=>h.key===a),l=((i=t==null?void 0:t.views)==null?void 0:i.value)||0,c=((d=t==null?void 0:t.downloads)==null?void 0:d.value)||0,o=((u=t==null?void 0:t.outlinks)==null?void 0:u.value)||0;n.push(l+c+o)}),n):(s.time.buckets.map(r=>{var c;const t=r.level.buckets.find(o=>o.key===a.scope),l=((c=t==null?void 0:t[a.event])==null?void 0:c.value)||0;n.push(l)}),n)},se=k,ne=R,te=({data:s,scopeLabels:a,eventLabels:n,activeScope:r,t,tabIndex:l})=>{const c=y.useRef(null);return y.useEffect(()=>{const o=B(c.current);if(c.current){const i=[];r==="ALL"?ne.map(g=>{g!=="ALL"&&i.push({name:`${a[g]}`,type:"bar",stack:"total",itemStyle:{color:T(g,"ALL")},data:E(s,g)})}):se.map(f=>({scope:r,event:f})).forEach(f=>{i.push({name:`${a[f.scope]} - ${n[f.event]}`,type:`${f.event===x.C?"line":"bar"}`,yAxisIndex:`${f.event===x.C?1:0}`,stack:`${f.event===x.C?"":"total"}`,itemStyle:{color:T(f.scope,f.event)},data:E(s,f)})});const d=s.time.buckets.map(g=>new Date(g.key_as_string).toLocaleString(`${t("calendar-lang")}`,{month:"short",year:"numeric"})),u=Math.max(...i[0].data),h=Math.max(...i[1].data),L=Math.max(...i[2].data),p=u+h+L,v={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{show:!1},grid:{left:"2%",top:"0%",right:"2%",bottom:"6%",containLabel:!1},yAxis:[{type:"value",max:p,name:"Total Access",nameTextStyle:{fontWeight:"bold",fontSize:13},show:!1},{type:"value",max:p,name:x.C,nameTextStyle:{fontWeight:"bold",fontSize:13},show:!1,alignTicks:!1,axisLine:{show:!0,lineStyle:{color:"#6e9ef1"}},axisLabel:{formatter:"{value}"}}],xAxis:{type:"category",data:d},series:i},S=()=>{o&&o.resize()};return window.addEventListener("resize",S),v&&o.setOption(v),()=>{window.removeEventListener("resize",S),o.dispose()}}},[r,l]),e.jsx(j,{shadow:"sm",borderRadius:"12",p:"6",children:e.jsx("div",{id:"bar-chart",ref:c,style:{height:"500px"}})})},M=(s,a)=>{var t,l,c;if(a==="ALL")return s.level.buckets.reduce((o,i)=>{var d,u,h;return o+(((d=i.views)==null?void 0:d.value)||0)+(((u=i.downloads)==null?void 0:u.value)||0)+(((h=i.outlinks)==null?void 0:h.value)||0)},0);const n=s.level.buckets.find(o=>o.key===a);return((((t=n==null?void 0:n.views)==null?void 0:t.value)||0)+(((l=n==null?void 0:n.downloads)==null?void 0:l.value)||0)+(((c=n==null?void 0:n.outlinks)==null?void 0:c.value)||0)).toLocaleString()},ae=(s,a,n)=>{let r=[];return s==="ALL"?r=["month",...Object.keys(a).map(t=>a[t])]:r=["month",...k.map(t=>n[t])],r},oe=(s,a,n)=>{let r=[];return s==="ALL"?r=a.time.buckets.map(t=>[new Date(t.key_as_string).toLocaleString(`${n("calendar-lang")}`,{month:"short",year:"numeric"}),R.map(l=>M(t,l)).join(",")].join(",")):r=a.time.buckets.map(t=>[new Date(t.key_as_string).toLocaleString(`${n("calendar-lang")}`,{month:"short",year:"numeric"}),k.map(l=>{var c,o;return((o=(c=t.level.buckets.find(i=>i.key===s))==null?void 0:c[l])==null?void 0:o.value.toLocaleString())||0}).join(",")].join(",")),r},re=(s,a,n,r,t)=>{const l=ae(s,r,t),c=oe(s,a,n),o=[l.join(","),...c].join(`
`),i=new Blob([o],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(i),u=document.createElement("a");u.href=d,u.download="data.csv",u.click(),URL.revokeObjectURL(d)},le=({data:s,eventLabels:a,activeScope:n,scopeLabels:r,t})=>{const[l,c]=y.useState(0),o=i=>Object.keys(i).map((u,h)=>e.jsxs(A,{children:[" ",i[u]," "]},h));return e.jsx(j,{padding:"4",shadow:"sm",borderRadius:"12",mt:6,children:e.jsxs(_,{children:[e.jsxs(N,{variant:"striped",colorScheme:"gray",size:"lg",children:[e.jsx($,{children:e.jsxs(b,{children:[e.jsx(A,{children:t("months")}),o(n==="ALL"?r:a)]})}),e.jsx(O,{children:s.time.buckets.map((i,d)=>e.jsxs(b,{children:[e.jsx(D,{children:new Date(i.key_as_string).toLocaleString(`${t("calendar-lang")}`,{month:"short",year:"numeric"})}),n==="ALL"?R.map((u,h)=>e.jsx(D,{children:M(i,u)},h)):k.map((u,h)=>{var L,p;return e.jsx(D,{children:((p=(L=i.level.buckets.find(v=>v.key===n))==null?void 0:L[u])==null?void 0:p.value.toLocaleString())||0},h)})]},d)).slice(10*l,10*(l+1))}),e.jsx(W,{display:"flex",justifyContent:"start",py:"4",children:e.jsx(b,{children:e.jsx(D,{children:e.jsx(w,{onClick:()=>re(n,s,t,r,a),colorScheme:"teal",children:t("csv-button")})})})})]}),e.jsx(m,{display:"flex",justifyContent:"space-evenly",children:e.jsxs(m,{display:"flex",gap:"2",children:[e.jsx(w,{variant:"ghost",onClick:()=>c(l-1),isDisabled:l===0,children:e.jsx(Z,{fontSize:"1.5rem"})}),e.jsx(m,{display:"flex",gap:"2",alignItems:"center",children:Array.from({length:Math.ceil(s.time.buckets.length/10)},(i,d)=>e.jsx(w,{variant:l===d?"solid":"outline",onClick:()=>c(d),children:d+1},d))}),e.jsx(w,{variant:"ghost",onClick:()=>c(l+1),isDisabled:10*(l+1)>=s.time.buckets.length,children:e.jsx(ee,{fontSize:"1.5rem"})})]})})]})})},ie=({data:s,eventLabels:a,activeScope:n,t:r})=>{const[t,l]=y.useState(s.level.buckets.filter(o=>o.key===n));y.useEffect(()=>{const o=[{key:"ALL",doc_count:0,views:{value:s.views.value},outlinks:{value:s.outlinks.value},downloads:{value:s.downloads.value},conversions:{value:s.conversions.value}}],i=s.level.buckets.filter(d=>d.key===n);l(n==="ALL"?o:i)},[n]);const c=[{title:x.V,label:a[x.V],value:s.views.value,icon:e.jsx(z,{})},{title:x.D,label:a[x.D],value:s.downloads.value,icon:e.jsx(U,{})},{title:x.O,label:a[x.O],value:s.outlinks.value,icon:e.jsx(Y,{})},{title:x.C,label:a[x.C],value:s.conversions.value,icon:e.jsx(V,{})}];return e.jsx(m,{children:t.map((o,i)=>e.jsxs(F,{gridTemplateColumns:{base:"repeat(1, minmax(0px, 1fr))",md:"repeat(2, minmax(0px, 1fr))",lg:"repeat(5, minmax(0px, 1fr))"},gap:"4",children:[e.jsx(j,{padding:"4",shadow:"sm",borderRadius:"12",children:e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(F,{children:[e.jsxs(m,{display:"flex",gap:"2",children:[e.jsx(C,{as:"span",fontWeight:"600",color:"gray",fontSize:"1.1rem",children:"Total"}),e.jsx(G,{label:r("tooltip-general-panel"),fontSize:"md",children:e.jsx(P,{fontSize:"12px",color:"teal"})})]}),e.jsx(C,{as:"span",fontWeight:"700",fontSize:"1.3rem",children:(o.downloads.value+o.views.value+o.outlinks.value).toLocaleString()})]}),e.jsx(j,{p:"4",bg:"gray.100",variant:"elevated",shadow:"xs",borderRadius:"12",children:e.jsx(H,{})})]})}),c.map((d,u)=>e.jsx(j,{padding:"4",shadow:"sm",borderRadius:"12",children:e.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(F,{children:[e.jsx(C,{as:"span",fontWeight:"600",color:"gray",fontSize:"1.1rem",children:d.label}),e.jsx(C,{as:"span",fontWeight:"700",fontSize:"1.3rem",children:o[d.title].value.toLocaleString()})]}),e.jsx(j,{p:"4",bg:"gray.100",variant:"elevated",shadow:"xs",borderRadius:"12",children:d.icon})]})},u))]},i))})},ce=({t:s,setRefresh:a,setStartDate:n,refresh:r,startDate:t})=>{const l=[{label:`6 ${s("months")}`,callback:new Date(new Date().setFullYear(new Date().getMonth()-6))},{label:`1 ${s("year")}`,callback:new Date(new Date().setFullYear(new Date().getFullYear()-1))},{label:`3 ${s("years")}`,callback:new Date(new Date().setFullYear(new Date().getFullYear()-3))}],c=o=>{n(o),console.log(o),a(!r)};return e.jsx(m,{borderRadius:"12",children:e.jsx(m,{display:"flex",gap:"2",children:l.map(({label:o,callback:i})=>e.jsx(j,{shadow:"sm",borderRadius:"12",p:"1",justifyContent:"center",rounded:"lg",children:e.jsx(w,{onClick:()=>c(i),size:"sm",fontWeight:"bold",variant:t===i?"solid":"outline",children:o})},o))})})},de=({scopeLabels:s,activeScope:a,setActiveScope:n})=>e.jsx(j,{shadow:"sm",mr:"4",borderRadius:"6",p:"1",children:e.jsxs(K,{children:[e.jsx(q,{as:w,variant:"outline",rightIcon:e.jsx(J,{}),children:s[a]}),e.jsx(Q,{children:s&&Object.keys(s).map(r=>e.jsx(X,{color:"gray.600",fontWeight:"medium",onClick:()=>n(r),children:s[r]},r))})]})}),ue=({t:s,scopeLabels:a,activeScope:n,setActiveScope:r,setStartDate:t,setRefresh:l,refresh:c,startDate:o})=>e.jsx(m,{my:"6",children:e.jsxs(m,{display:"flex",justifyContent:"space-between",children:[e.jsx(m,{display:"flex",alignItems:"center",children:e.jsx(de,{scopeLabels:a,activeScope:n,setActiveScope:r})}),e.jsx(ce,{t:s,setRefresh:l,setStartDate:t,refresh:c,startDate:o})]})}),ge=({data:s,scopeLabels:a,eventLabels:n,activeScope:r,setActiveScope:t,t:l,tabIndex:c,setStartDate:o,setRefresh:i,refresh:d,startDate:u})=>e.jsxs(e.Fragment,{children:[e.jsx(ie,{data:s,scopeLabels:a,eventLabels:n,activeScope:r,t:l}),e.jsx(ue,{t:l,scopeLabels:a,activeScope:r,setActiveScope:t,setStartDate:o,setRefresh:i,refresh:d,startDate:u}),e.jsx(te,{data:s,scopeLabels:a,eventLabels:n,activeScope:r,setActiveScope:t,t:l,tabIndex:c}),e.jsx(le,{data:s,eventLabels:n,scopeLabels:a,activeScope:r,t:l})]});export{ge as default};
